<?xml version="1.0" encoding="utf-8"?>
<jobs>
	<instanceguid>276302b1-8de5-494d-8283-de0765958a99</instanceguid>
	<job>
		<id>2370</id>
		<jobname>FO 48.01 Transport Orders maken obv Ontvangst</jobname>
		<disable>False</disable>
		<emailbody></emailbody>
		<emailmode>1</emailmode>
		<emailsubject></emailsubject>
		<emailto>h.oosting@absc.nl</emailto>
		<remarks>
			219: 00.933.786
			FO: 04.162.147
			Extend to Warehouse 96 CD 04.345.682

			w.vander.burg@absc.nl
		</remarks>
		<schedulename></schedulename>
		<schedulesettings></schedulesettings>
		<settings></settings>
		<settingsxml>
			<settings>
				<schedule>
					<forceseparaterun>false</forceseparaterun>
					<allowmultipleprocessorinstances>false</allowmultipleprocessorinstances>
					<schedules>
						<scheduledetails>
							<scheduleid>0</scheduleid>
							<allowmultipleprocessorinstances>False</allowmultipleprocessorinstances>
							<forceseparaterun>0</forceseparaterun>
							<freq>1</freq>
							<timescale>minutes</timescale>
							<frequency>weekly</frequency>
							<frequency_recurrence>1</frequency_recurrence>
							<frequency_dayofmonth>1</frequency_dayofmonth>
							<frequency_dayofmonth_day>1</frequency_dayofmonth_day>
							<frequency_dayofmonth_daypos>1</frequency_dayofmonth_daypos>
							<frequency_dayofmonth_type>nr</frequency_dayofmonth_type>
							<scheduledenabled>-1</scheduledenabled>
							<startat>11:26:27</startat>
							<beginat>07:02:00</beginat>
							<endat>17:59:59</endat>
							<day1>-1</day1>
							<day2>-1</day2>
							<day3>-1</day3>
							<day4>-1</day4>
							<day5>-1</day5>
							<day6>0</day6>
							<day7>0</day7>
							<duration_start>2022-09-04</duration_start>
							<duration_end>2074-01-05</duration_end>
						</scheduledetails>
					</schedules>
				</schedule>
				<general>
					<maxjobstepactions>9999</maxjobstepactions>
				</general>
				<gui>
					<appearancesettings />
				</gui>
				<jobparams>
					<jobparam>
						<name>param_email_for_send_message</name>
						<type>String</type>
						<value>h.oosting@absc.nl</value>
					</jobparam>
					<jobparam>
						<name>param_eg_database_name</name>
						<type>String</type>
						<value>115</value>
					</jobparam>
					<jobparam>
						<name>param_eg_division</name>
						<type>String</type>
						<value>115</value>
					</jobparam>
					<jobparam>
						<name>param_number_of_records_per_run</name>
						<type>String</type>
						<value>100</value>
					</jobparam>
					<jobparam>
						<name>param_number_of_records_per_api_call</name>
						<type>String</type>
						<value>5</value>
					</jobparam>
					<jobparam>
						<name>param_max_retry_counter</name>
						<type>String</type>
						<value>6</value>
					</jobparam>
					<jobparam>
						<name>Tablename_Preceder</name>
						<type>String</type>
						<value>_AB_tb_FO-48-FreeOnBoard</value>
					</jobparam>
					<jobparam>
						<name>param_from_receive_date_99</name>
						<type>String</type>
						<value>2023-08-01</value>
					</jobparam>
					<jobparam>
						<name>param_default_transporterCreditor</name>
						<type>String</type>
						<value>   356</value>
					</jobparam>
					<jobparam>
						<name>param_log_max_retain_days</name>
						<type>String</type>
						<value>60</value>
					</jobparam>
					<jobparam>
						<name>param_order_Header_additionalfield_name</name>
						<type>String</type>
						<value>Field09</value>
					</jobparam>
					<jobparam>
						<name>param_order_Line_additionalfield_name</name>
						<type>String</type>
						<value>Field09</value>
					</jobparam>
					<jobparam>
						<name>param_retry_directly</name>
						<type>String</type>
						<value>false</value>
					</jobparam>
					<jobparam>
						<name>param_TransportOrder_SelectionCode</name>
						<type>String</type>
						<value>TR</value>
					</jobparam>
					<jobparam>
						<name>param_from_receive_date_98</name>
						<type>String</type>
						<value>2024-01-01</value>
					</jobparam>
				</jobparams>
			</settings>
		</settingsxml>
		<steps>
			<step>
				<id>5390</id>
				<entity>-none-</entity>
				<action>process</action>
				<source>0</source>
				<target>80</target>
				<datasource>
					SELECT TOP (1)
					CASE WHEN x.id IS NULL THEN 0 ELSE 1 END as doQuit

					FROM    (VALUES (0)) as l(v)
					OUTER APPLY (select r.id
					FROM    [%abeidb%].[dbo].[_AB_Entity_Log] as r WITH (NOLOCK)
					WHERE 1=1
					AND r.jobid = '%jobid%'
					AND r.runid != '%runid%'
					AND r.syscreated &gt; DATEADD(HOUR, -2, CURRENT_TIMESTAMP) -- check for max 2 hours back
					AND NOT EXISTS (SELECT rl.id
					FROM    [%abeidb%].[dbo].[_AB_Entity_Log] as rl WITH (NOLOCK)
					WHERE 1=1
					AND rl.runid = r.runid
					AND rl.jobid = r.jobid
					AND rl.seqno = -10
					) -- -10 is 'Finished Running Job'
					) as x
					WHERE 1=1

				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>0</seqno>
				<settings>uniquekey=;retryunique=0;sysaction=6;sysfilefolder=;sysparams=;syswait=True;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns />
						</general>
						<systemtarget>
							<systemtarget_param2 />
							<systemtarget_param3 />
							<systemtarget_skiptoseqno />
							<systemtarget_sleep>0</systemtarget_sleep>
							<systemtarget_user />
							<systemtarget_pwd>TFEEY7QNB86Yzc1ll50jtg%equalchar%%equalchar%</systemtarget_pwd>
						</systemtarget>
					</settings>
				</settingsxml>
				<stepname>Quit job if job already running</stepname>
			</step>
			<step>
				<id>5391</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>0</source>
				<target>101</target>
				<datasource>
					update Settings set BitValue = 1
					where SettingName = 'UseAdditionalFields'

				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>1</seqno>
				<settings>uniquekey=;retryunique=0;sysaction=6;sysfilefolder=;sysparams=;syswait=True;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns />
						</general>
						<systemtarget>
							<systemtarget_param2 />
							<systemtarget_param3 />
							<systemtarget_skiptoseqno />
							<systemtarget_sleep>0</systemtarget_sleep>
							<systemtarget_user />
							<systemtarget_pwd>TFEEY7QNB86Yzc1ll50jtg%equalchar%%equalchar%</systemtarget_pwd>
						</systemtarget>
					</settings>
				</settingsxml>
				<stepname>Activate additional fields (EG)</stepname>
			</step>
			<step>
				<id>5392</id>
				<entity>-none-</entity>
				<action>textline</action>
				<source>0</source>
				<target>0</target>
				<datasource></datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>1</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>10</seqno>
				<settings></settings>
				<settingsxml />
				<stepname>==  Initialize &amp; Maintain Data Structure  ==</stepname>
			</step>
			<step>
				<id>5393</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>103</source>
				<target>103</target>
				<datasource>
					-- Create Log Table
					IF NOT EXISTS (SELECT * FROM [%abeitargetdb%].sys.objects WHERE name = N'%Tablename_Preceder%_Log' AND type in (N'U'))
					BEGIN
					CREATE TABLE [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log](
					[id] [int] IDENTITY(1,1) NOT NULL,
					[ExactDbNum] INT NOT NULL,
					[runid] [uniqueidentifier] NULL,
					[subject] [varchar](255) NULL,
					[message] [varchar](max) NULL,
					[jobid] [int] NULL,
					[jobstepid] [int] NULL,
					[seqno] [int] NULL,
					[rowstatus] [int] NULL,
					[source] [varchar](100) NULL,
					[syscreated] [datetime] NOT NULL,
					[host] [varchar](100) NULL,

					[bkstnr] varchar(20)  NULL,  -- ontvangst boeking nummer
					[orderLineID] int  NULL,
					[ordernr] CHAR(8)  NULL,
					[transportOrderNr] char(8) NULL,
					[transportOrderLineId] int NULL,


					[initalPurchaseOrderNr] char(8) NULL,
					[initalPurchaseOrderLineId] int NULL

					) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

					CREATE NONCLUSTERED INDEX [rowstatus_index_Log] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (
					[rowstatus] ASC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

					CREATE NONCLUSTERED INDEX [syscreated_index_Log] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (
					[syscreated] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [bkstnr_index_Log] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (
					[bkstnr] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [orderLineID_index_Log] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (
					[orderLineID] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [ordernr_index_Log] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (
					[ordernr] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [transportOrderNr_index_Log] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (
					[transportOrderNr] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [transportOrderLineId_index_Log] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (
					[transportOrderLineId] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [initalPurchaseOrderNr_index_Log] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (
					[initalPurchaseOrderNr] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [initalPurchaseOrderLineId_index_Log] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (
					[initalPurchaseOrderLineId] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

					END


					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, 'Table(s) %Tablename_Preceder%_*', 'Job started. Log is present.')


					-- [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, 'Table(s) %Tablename_Preceder%_*', 'Checking Initial_PurchaseOrder_Receipts.')

					IF NOT EXISTS (SELECT * FROM sys.objects WHERE name = N'%Tablename_Preceder%_Initial_PurchaseOrder_Receipts' AND type in (N'U'))
					BEGIN
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, 'Table(s) %Tablename_Preceder%_*', 'Creating Initial_PurchaseOrder_Receipts.')

					CREATE TABLE  [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]
					(
					[Id] INT IDENTITY (1, 1) NOT NULL PRIMARY KEY,
					[ExactDbNum] INT NOT NULL,

					[bkstnr] varchar(20) NOT NULL, -- ontvangst boeking nummer
					[ordernr] CHAR(8) NOT NULL,
					[orderLineID] int NOT NULL,

					[artcode] varchar(30) NOT NULL,
					[aantal] float NOT NULL default 0,
					[datumOntvangst] datetime NOT NULL,

					[levwijze] CHAR(5) NOT NULL,
					[planned_deliveryDate] datetime NOT NULL,
					[purchaseCreditor]  CHAR(6) NOT NULL,
					[additionalDelDays] float NOT NULL default 42,
					[transporterCreditor]  CHAR(6) NOT NULL,

					[transportOrderNr] char(8) NULL,
					[transportOrderLineId] int NULL,
					[transportOrderAuthorized] [bit] NULL,
					[transportOrderPrinted] [bit] NULL,

					[syscreated] DATETIME NOT NULL,
					[sysmodified] DATETIME NOT NULL,
					[runid] UNIQUEIDENTIFIER NOT NULL,
					[rowstatus] INT NOT NULL DEFAULT 0, -- 2 = success, -1 = fail, 0 = TODO, 1=being processed
					[sysmessage] nvarchar(max) NULL,    -- why rowstatus
					[retry_counter] INT NULL
					)
					CREATE NONCLUSTERED INDEX [rowstatus_index_Initial_PurchaseOrder_Receipts] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts] (
					[rowstatus] ASC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

					CREATE NONCLUSTERED INDEX [syscreated_index_Initial_PurchaseOrder_Receipts] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts] (
					[syscreated] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [bkstnr_index_Initial_PurchaseOrder_Receipts] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts] (
					[bkstnr] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [orderLineID_index_Initial_PurchaseOrder_Receipts] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts] (
					[orderLineID] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [ordernr_index_Initial_PurchaseOrder_Receipts] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts] (
					[ordernr] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [transportOrderNr_index_Initial_PurchaseOrder_Receipts] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts] (
					[transportOrderNr] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
					CREATE NONCLUSTERED INDEX [transportOrderLineId_index_Initial_PurchaseOrder_Receipts] ON [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts] (
					[transportOrderLineId] DESC
					)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

					END
					ELSE
					BEGIN
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, 'Table(s) %Tablename_Preceder%_*', 'Initial_PurchaseOrder_Receipts Exists.')
					END
				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>10</seqno>
				<settings></settings>
				<settingsxml />
				<stepname>ABSC: Initialiseer Datamodel</stepname>
			</step>
			<step>
				<id>5444</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>103</source>
				<target>103</target>
				<datasource>
					-- FO-48 Extend CD 04.345.682

					IF NOT EXISTS (SELECT *
					FROM sys.columns
					WHERE object_id = OBJECT_ID(N'[dbo].[%Tablename_Preceder%_Log]')
					AND [name] = 'magcode'
					)
					BEGIN
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, 'Table(s) %Tablename_Preceder%_*', 'Log needs to have magcode columns added and updated (99/03).')

					ALTER TABLE [dbo].[%Tablename_Preceder%_Log]
					ADD --COLUMN

					[magcode_FoB] char(4) NULL
					, [magcode] char(4) NULL

					-- (Old FoB functionality was about these specific magcodes (Warhouse)
					-- In isolated EXEC to allow columns to be created first
					EXEC ('
					UPDATE [dbo].[_AB_tb_FO-48-FreeOnBoard_Log]
					SET
					[magcode_FoB] = ''99''
					, [magcode] = ''03''
					')
					END

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, 'Table(s) %Tablename_Preceder%_*', 'Log has magcode columns.')


					IF NOT EXISTS (SELECT *
					FROM sys.columns
					WHERE object_id = OBJECT_ID(N'[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]')
					AND [name] = 'magcode'
					)
					BEGIN
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, 'Table(s) %Tablename_Preceder%_*', 'Initial_PurchaseOrder_Receipts needs to have magcode columns added and updated (99/03).')

					ALTER TABLE [dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]
					ADD --COLUMN

					[magcode_FoB] char(4) NULL
					, [magcode] char(4) NULL

					-- (Old FoB functionality was about these specific magcodes (Warhouse)
					-- In isolated EXEC to allow columns to be created first
					EXEC ('
					UPDATE [dbo].[_AB_tb_FO-48-FreeOnBoard_Initial_PurchaseOrder_Receipts]
					SET
					[magcode_FoB] = ''99''
					, [magcode] = ''03''
					')
					END

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, 'Table(s) %Tablename_Preceder%_*', 'Initial_PurchaseOrder_Receipts has magcode columns.')


				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>15</seqno>
				<settings></settings>
				<settingsxml />
				<stepname>ABSC: Extend Datamodel (Warehouse)</stepname>
			</step>
			<step>
				<id>5394</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>103</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'ABSC: Clear old log'
					DECLARE @oldestDate datetime = DATEADD(d, -%param_log_max_retain_days%, GETDATE())
					DECLARE @numProcessed int

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Clearing log entries oldert than %param_log_max_retain_days% days, from: '+ convert(varchar(25), @oldestDate, 120))

					DELETE FROM  [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] WITH (ROWLOCK, NOWAIT)
					WHERE syscreated &lt; @oldestDate


					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Deleted: ' + CONVERT(varchar(10), @numProcessed)+ ' log entries' )

				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>20</seqno>
				<settings></settings>
				<settingsxml />
				<stepname>ABSC: Clear old log</stepname>
			</step>
			<step>
				<id>5395</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>101</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'EG: Check for new PurchaseOrder Deliveries'

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Looking for newly delivered initial Purchase Orders.')

					DECLARE @numToProcess int

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]
					(syscreated, sysmodified, runId, rowstatus, sysmessage, ExactDbNum,
					[bkstnr], -- varchar(20) NOT NULL, -- ontvangst boeking nummer (varchar(20))
					[datumOntvangst],-- datetime NOT NULL,
					[ordernr], --CHAR(8) NOT NULL,
					[levwijze], --CHAR(5) NOT NULL,
					[planned_deliveryDate], -- datetime NOT NULL,
					[purchaseCreditor], --  CHAR(6) NOT NULL,
					[additionalDelDays], -- float NOT NULL default 42,
					[transporterCreditor], -- CHAR(6) NOT NULL
					[orderLineID], -- int NOT NULL,
					[artcode], -- varchar(30) NOT NULL
					[aantal], -- float NOT NULL default 0,
					[magcode_FoB] --char(4) NULL  -- FO-48 Extend CD 04.345.682
					)
					SELECT
					CURRENT_TIMESTAMP as syscreated, CURRENT_TIMESTAMP as [sysmodified], '%runid%' as runId, 0 as rowstatus, @stepName as sysmessage, %param_eg_division% as ExactDbNum,
					receipts.bkstnr -- ontvangst boeking nummer (varchar(20))
					, receipts.datum as datumOntvangst
					, receipts.ordernr
					, receipts.levwijze
					, receipts.afldat as planned_deliveryDate
					, receipts.crdnr as purchaseCreditor
					, ISNULL(cpo.numberfield2, 42) as additionalDelDays
					, CASE UPPER(receipts.levwijze)
					WHEN 'DHL' THEN '   356'
					WHEN 'ROTRA' THEN '  3379'
					WHEN 'FEDEX' THEN '   842'
					ELSE '%param_default_transporterCreditor%'
					END as transporterCreditor
					, POline.ID as orderLineID --(int)
					, GM.artcode -- (varchar(30))
					, GM.aantal  -- float
					, GM.warehouse -- [magcode_FoB] -- FO-48 Extend CD 04.345.682
					FROM  (SELECT DISTINCT TOP  %param_number_of_records_per_run%            -- MAX num records: bkstnr: Receipt slips
					currentRunGM.bkstnr
					, currentRunGM.datum
					, POHead.ordernr
					, POHead.levwijze
					, POHead.afldat
					, POHead.CrdNr
					FROM [%abeisourcedb%].[dbo].[gbkmut] AS currentRunGM WITH (NOLOCK)
					INNER JOIN [%abeisourcedb%].[dbo].[Items] AS currentRunIT WITH (NOLOCK)
					ON currentRunIT.ItemCode = currentRunGM.artcode
					AND currentRunGM.reknr = currentRunIT.GLAccountDistribution         -- Filter voorraad boekingen
					INNER JOIN [%abeisourcedb%].[dbo].[orkrg] AS POHead WITH (NOLOCK)
					ON POHead.ordernr = currentRunGM.bkstnr_sub
					LEFT JOIN [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts] AS iPOr WITH (NOLOCK)
					ON currentRunGM.bkstnr = iPOr.bkstnr            -- in process
					WHERE 1=1
					-- Filter receipts in Warehouse 03
					AND currentRunGM.transtype = 'N'                -- Gerealiseerd (itt Gepland 'B')
					AND currentRunGM.transsubtype = 'A'             -- Spullen
					AND (
					(currentRunGM.warehouse ='99' AND currentRunGM.datum &gt;='%param_from_receive_date_99%')   -- Received in WareHouse 99 &amp; Start date from
					OR
					(currentRunGM.warehouse ='98' AND currentRunGM.datum &gt;='%param_from_receive_date_98%')   -- Received in WareHouse 98: -- FO-48 Extend CD 04.345.682
					)

					-- Filter Purchase  Orders
					AND POHead.ord_soort = 'B'                  -- Purchase Order
					AND POHead.magcode IN ('99','98')                     -- Warehouse 99 /98  PO was meant for Warehouse 99 /98(Filter Free On Board PO's) Warehouse 98: -- FO-48 Extend CD 04.345.682
					AND UPPER(POHead.levwijze) in ('TNT', 'DHL', 'ROTRA', 'FEDEX') -- FILTER ONLY 'Known' LEVWijze for WareHouse 99 / 98
					-- NOT already in process
					AND iPOr.ID IS NULL
					ORDER BY currentRunGM.datum ASC
					) as receipts
					INNER JOIN [%abeisourcedb%].[dbo].[gbkmut] AS GM WITH (NOLOCK)
					ON GM.bkstnr = receipts.bkstnr
					INNER JOIN [%abeisourcedb%].[dbo].[orsrg] AS POline WITH (NOLOCK)
					on POline.sysguid = GM.LinkedLine
					INNER JOIN [%abeisourcedb%].[dbo].[Items] AS IT WITH (NOLOCK)
					ON IT.ItemCode = GM.artcode
					AND GM.reknr = IT.GLAccountDistribution         -- Filter voorraad boekingen
					LEFT JOIN [%abeisourcedb%].[dbo].cicmpy AS cpo WITH(NOLOCK)
					ON cpo.CrdNr = receipts.CrdNr





					SELECT @numToProcess=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Found: ' + CONVERT(varchar(10), @numToProcess)+ ' newly delivered initial Purchase Orders' )


					-- 'Transaction Log' for T-Shoot and insight in retries....
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT
					, bkstnr
					, ordernr
					, orderLineID
					, MESSAGE )
					SELECT %param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName
					, iPOr.bkstnr
					, iPOr.ordernr
					, iPOr.orderLineID
					, 'Receipt for initial Purchase Order detected.'
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					WHERE iPOr.rowstatus = 0 -- TODO
					AND '%runid%' = iPOr.runid --Explicitely this run only
				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>60</seqno>
				<settings></settings>
				<settingsxml />
				<stepname>EG: Check for new PurchaseOrder Deliveries</stepname>
			</step>
			<step>
				<id>5396</id>
				<entity>-none-</entity>
				<action>textline</action>
				<source>0</source>
				<target>0</target>
				<datasource></datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>1</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>60</seqno>
				<settings></settings>
				<settingsxml />
				<stepname>==       Get &amp; Check Data to Process      ==</stepname>
			</step>
			<step>
				<id>5397</id>
				<entity>-none-</entity>
				<action>process</action>
				<source>103</source>
				<target>80</target>
				<datasource>
					SELECT [ordernr]
					FROM [%abeisourcedb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]
					WHERE 1=1
					AND (rowstatus = 0 -- TODO
					OR rowstatus = 1 -- being processed
					)
					--AND runId = '%runid%' -- NOT this run only
				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>70</seqno>
				<settings>uniquekey=;retryunique=0;sysaction=6;sysfilefolder=;sysparams=;syswait=True;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<jobparams />
							<datacolumns />
						</general>
						<systemtarget>
							<systemtarget_param2 />
							<systemtarget_param3 />
							<systemtarget_param4 />
							<systemtarget_param5 />
							<systemtarget_param6 />
							<systemtarget_skiptoseqno />
							<systemtarget_sleep>0</systemtarget_sleep>
							<systemtarget_user />
							<systemtarget_pwd>TFEEY7QNB86Yzc1ll50jtg%equalchar%%equalchar%</systemtarget_pwd>
						</systemtarget>
					</settings>
				</settingsxml>
				<stepname>Stop Job if nothing to do ------------------</stepname>
			</step>
			<step>
				<id>5398</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>101</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'EG: Check for existing TransportOrders'
					DECLARE @numProcessed int

					-- Check Previously Created Transport Order / Line (s)

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Check Previously Created Transport Order / Line (s)')

					UPDATE iPOr  SET
					--SELECT *,
					[sysmessage] = CASE WHEN iPOr.[sysmessage]  IS NULL
					THEN 'Previously Created Transport Order / Line Found'
					ELSE 'Previously Created Transport Order / Line Found' + CHAR(13) + CHAR(10)
					+ iPOr.[sysmessage]
					END
					, sysmodified = CURRENT_TIMESTAMP
					, [transportOrderNr] = ISNULL(iPOr.[transportOrderNr], ol.ordernr)      -- Do NOT Overwrite if already present
					, [transportOrderLineId] = ISNULL(iPOr.[transportOrderLineId], ol.ID)   -- Do NOT Overwrite if already present
					, [transportOrderAuthorized] =  CASE oh.fiattering WHEN 'J' THEN 1 ELSE 0 END
					, [transportOrderPrinted] = oh.ordbv_afgd --[bit] NOT NULL
					, [magcode] = oh.[magcode]  -- FO-48 Extend CD 04.345.682
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (ROWLOCK, NOWAIT)
					LEFT JOIN [%abeisourcedb%].dbo.AdditionalOrderHeader oht with (nolock)
					ON oht.[%param_order_Header_additionalfield_name%] = iPOr.ordernr -- double check
					INNER JOIN [%abeisourcedb%].dbo.orkrg oh  WITH (NOLOCK)
					ON oh.ordernr = oht.OrderNumber
					LEFT JOIN [%abeisourcedb%].dbo.AdditionalOrderLines olt WITH (NOLOCK)
					ON  LTRIM(RTRIM(STR(iPOr.[orderLineID]))) = olt.[%param_order_Line_additionalfield_name%] COLLATE DATABASE_DEFAULT
					LEFT JOIN [%abeisourcedb%].dbo.orsrg ol WITH (NOLOCK)
					ON olt.OrderNumber = ol.ordernr
					AND olt.LineNumber = ol.regel

					WHERE oh.ordernr IS NOT NULL AND ol.ID IS NOT NULL            -- FOUND
					AND (iPOr.rowstatus = 1        -- being processed
					OR iPOr.rowStatus = 0      -- OR TODO
					)
					AND (iPOr.transportOrderNr IS NULL      -- Not already listed
					OR iPOr.transportOrderLineId IS NULL
					)


					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Found: ' + CONVERT(varchar(10), @numProcessed)+ ' Previously Created Transport Order / Line (s)' )


					-- LIST Success

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Check Order &amp; OrderLine Registration.')


					-- 'Transaction Log' for T-Shoot and insight in retries....
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT
					, bkstnr
					, ordernr
					, orderLineID
					, MESSAGE
					, transportOrderNr
					, transportOrderLineId
					, [magcode_FoB] -- FO-48 Extend CD 04.345.682
					, [magcode]     -- FO-48 Extend CD 04.345.682
					)
					SELECT %param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName
					, iPOr.bkstnr
					, iPOr.ordernr
					, iPOr.orderLineID
					, 'Previously Created Transport Order / Line (s) found. Not processing this Purchase Order, setting rowstatus = 2'
					, iPOr.transportOrderNr
					, iPOr.transportOrderLineId
					, iPOr.[magcode_FoB]  -- FO-48 Extend CD 04.345.682
					, iPOr.[magcode]      -- FO-48 Extend CD 04.345.682
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					WHERE (iPOr.rowstatus = 1 -- being processed
					OR iPOr.rowStatus = 0 -- TODO
					)
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed
					AND iPOr.transportOrderLineId IS NOT NULL -- Transport Order Line has been listed
					AND iPOr.transportOrderPrinted = 1

					UPDATE iPOr  SET
					--SELECT *,
					runid = '%runid%'
					, rowstatus = 2
					--   , [retry_counter]= CASE WHEN ISNULL(EntR.rowstatus,-1) &lt;&gt; 2 THEN iPOr.[retry_counter] + 1 ELSE iPOr.[retry_counter] END
					, sysmodified = CURRENT_TIMESTAMP
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (ROWLOCK, NOWAIT)
					WHERE (iPOr.rowstatus = 1 -- being processed
					OR iPOr.rowStatus = 0 -- TODO
					)
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed
					AND iPOr.transportOrderLineId IS NOT NULL -- Transport Order Line has been listed
					AND iPOr.transportOrderAuthorized = 1
					AND iPOr.transportOrderPrinted = 1

					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Sucessfully registered: ' + CONVERT(varchar(10), @numProcessed)+ ' Previously Created Transport OrderLines (including Orders)' )

				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>80</seqno>
				<settings></settings>
				<settingsxml />
				<stepname>EG: Check for existing TransportOrders</stepname>
			</step>
			<step>
				<id>5399</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>103</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'ABSC: Set Processing Status'
					DECLARE @numProcessed int


					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Setting processing status (rowstatus = 1).')

					UPDATE iPOr
					SET rowstatus = 1
					, retry_counter = 0    -- First Try
					, runid = '%runid%'
					, sysmodified = CURRENT_TIMESTAMP
					, [magcode] = CASE iPOr.[magcode_FoB]
					WHEN '99' THEN '03'
					WHEN '98' THEN '16'
					END-- FO-48 Extend CD 04.345.682
					--   SELECT *
					FROM  [%abeisourcedb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (ROWLOCK, NOWAIT)
					-- Ensure all Orderlines per PO-Receipt are selected
					INNER JOIN (SELECT DISTINCT TOP %param_number_of_records_per_api_call%
					bkstnr, datumOntvangst
					FROM   [%abeisourcedb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts] WITH (NOLOCK)
					WHERE rowstatus = 0
					ORDER BY datumOntvangst ASC
					) as sel
					ON iPOr.bkstnr = sel.bkstnr



					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Set: ' + CONVERT(varchar(10), @numProcessed)+ ' received order lines ready to process  (rowstatus = 1)' )

					-- 'Transaction Log' for T-Shoot and insight in retries....
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT
					, bkstnr
					, ordernr
					, orderLineID
					, MESSAGE
					, [magcode_FoB] -- FO-48 Extend CD 04.345.682
					, [magcode]     -- FO-48 Extend CD 04.345.682
					)
					SELECT %param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName
					, iPOr.bkstnr
					, iPOr.ordernr
					, iPOr.orderLineID
					, 'Start processing this Purchase Order in this run'
					, iPOr.[magcode_FoB]  -- FO-48 Extend CD 04.345.682
					, iPOr.[magcode]      -- FO-48 Extend CD 04.345.682
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					WHERE iPOr.rowstatus = 1 -- Processing
					AND '%runid%' = iPOr.runid --Explicitely this run only
				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>90</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>refer</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>magcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>selcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>ord_soort</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>fiattering</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordbv_afgd</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>colli</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bruto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>netto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>tot_bdr</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ord_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ship_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_kb_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_disc_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_ev_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>projectnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield1</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield2</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>ABSC: Set Processing Status &amp; Warehouse (rowstatus = 1)</stepname>
			</step>
			<step>
				<id>5400</id>
				<entity>-none-</entity>
				<action>process</action>
				<source>103</source>
				<target>80</target>
				<datasource>
					SELECT [ordernr]
					FROM [%abeisourcedb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]
					WHERE 1=1
					AND  rowstatus = 1 -- being processed
					--AND runId = '%runid%' -- NOT this run only
				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>95</seqno>
				<settings>uniquekey=;retryunique=0;sysaction=6;sysfilefolder=;sysparams=;syswait=True;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<jobparams />
							<datacolumns />
						</general>
						<systemtarget>
							<systemtarget_param2 />
							<systemtarget_param3 />
							<systemtarget_param4 />
							<systemtarget_param5 />
							<systemtarget_param6 />
							<systemtarget_skiptoseqno />
							<systemtarget_sleep>0</systemtarget_sleep>
							<systemtarget_user />
							<systemtarget_pwd>TFEEY7QNB86Yzc1ll50jtg%equalchar%%equalchar%</systemtarget_pwd>
						</systemtarget>
					</settings>
				</settingsxml>
				<stepname>Stop Job if nothing to do ------------------</stepname>
			</step>
			<step>
				<id>5401</id>
				<entity>-none-</entity>
				<action>textline</action>
				<source>0</source>
				<target>0</target>
				<datasource></datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>1</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>96</seqno>
				<settings></settings>
				<settingsxml />
				<stepname>||                   DO ACTION                   ||</stepname>
			</step>
			<step>
				<id>5402</id>
				<entity>ItemAccount</entity>
				<action>create</action>
				<source>103</source>
				<target>101</target>
				<datasource>
					SELECT DISTINCT
					iPOr.artcode as ItemCode
					, iPOr.transporterCreditor as crdnr
					, 0 as PurchasePrice
					FROM [%abeisourcedb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					LEFT JOIN [%param_eg_database_name%].[dbo].[ItemAccounts] as IA WITH (NOLOCK)
					ON IA.crdnr = iPOr.transporterCreditor
					AND IA.ItemCode = iPOr.artcode
					WHERE iPOr.rowstatus = 1
					AND IA.ID IS NULL

				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>99</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey>ItemCode</referencekey>
							<datacolumns>
								<datacolumn>
									<name>ItemCode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>EG: Check or Create Item-Creditor Relation</stepname>
			</step>
			<step>
				<id>5403</id>
				<entity>PurchaseOrderLine</entity>
				<action>create</action>
				<source>103</source>
				<target>101</target>
				<datasource>
					SELECT
					iPOr.[bkstnr] as HeaderID
					, iPOr.[orderLineID] as referenceKey
					, iPOr.artcode
					, CAST(iPOr.aantal as decimal)  as esr_aantal
					, 0 as bdr_ev_ed_val
					--    , DATEADD(d, CONVERT(int,iPOr.[additionalDelDays]), PO.[afldat]) as [afldat]
					--, DATEADD(d, CONVERT(int,iPOr.[additionalDelDays]), iPOr.[datumOntvangst]) as [afldat] --28/8 Aanpassing TWI en Jochum (Quooker). De afldat moet bepaald worden adhv de ontvangstdatum
					, DATEADD(d, CONVERT(int,CASE WHEN ia.Warranty = 0 THEN additionalDelDays ELSE ia.Warranty END), iPOr.[datumOntvangst]) as [afldat]
					,  STR(iPOr.[orderLineID]) as [%param_order_Line_additionalfield_name%]
					,  1 as [IsUseAdditionalFields]
					FROM [%abeisourcedb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					INNER JOIN [%param_eg_database_name%].[dbo].[orkrg] as PO WITH (NOLOCK) ON PO.ordernr = iPOr.ordernr
					INNER JOIN [%param_eg_database_name%].[dbo].[ItemAccounts] as ia WITH (NOLOCK) on ia.crdnr = po.crdnr and ia.ItemCode = iPOr.artcode --9/4/23 Aanpassing TWI op verzoek van Jochum.
					WHERE iPOr.rowstatus = 1
				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>100</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey>referenceKey</referencekey>
							<datacolumns>
								<datacolumn>
									<name>HeaderID</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>referenceKey</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>artcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>esr_aantal</name>
									<type>Decimal</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_ev_ed_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>Field09</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>IsUseAdditionalFields</name>
									<type>Int32</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>EG: Create TransportOrder (Lines)</stepname>
			</step>
			<step>
				<id>5404</id>
				<entity>PurchaseOrderHeader</entity>
				<action>create</action>
				<source>103</source>
				<target>101</target>
				<datasource>
					SELECT DISTINCT
					iPOr.[bkstnr] as HeaderID,
					iPOr.[bkstnr] as referenceKey
					--,[debnr]
					--,[fakdebnr]
					--,[verzdebnr]
					--,[naldebnr]
					--,[einddebnr]
					--,
					, '%param_TransportOrder_SelectionCode%-' + egOH.[ordernr]+'-'+ iPOr.[bkstnr] as [refer] -- TODO: Check
					--,[refer1] --iPOr.[bkstnr] as  [refer1]        -- TODO: Check
					--,[refer2]
					--,[refer3]
					,egOH.[orddat]
					, DATEADD(d, CONVERT(int,iPOr.[additionalDelDays]), egOH.[afldat]) as [afldat]
					, iPOr.[magcode] -- FO-48 Extend CD 04.345.682
					, '%param_TransportOrder_SelectionCode%' as selcode
					,'B'as [ord_soort] -- Exact Type Purchase Order
					,1 as [fiattering]
					,1 as [ordbv_afgd]
					--,[afgehandld]
					--,[nettoprijs]
					,egOH.[levwijze]
					--,[vrachtkost]
					--,[orderkost]
					,[colli]
					,[bruto_gew]
					,[netto_gew]
					,0 as [tot_bdr]
					--,[user_id]  -- TODO: Check fill with ABSC / ABEI user
					, iPOr.[transporterCreditor] as [crdnr] -- TODO: Check
					,[projectnr]
					--,[freefield1]         -- For Filling Out Transport Order ID in initial Purchase Order
					,egOH.[ordernr] as [%param_order_Header_additionalfield_name%]         -- For Filling Out Initial Purchase Order ID on Transport Order
					,  1 as [IsUseAdditionalFields]
					FROM [%abeisourcedb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					INNER JOIN [%param_eg_database_name%].[dbo].[orkrg] as egOH WITH (NOLOCK)
					ON egOH.ordernr = iPOr.ordernr
					WHERE iPOr.rowstatus = 1
					AND iPOr.transportOrderNr IS NULL
				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>100</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey>referenceKey</referencekey>
							<datacolumns>
								<datacolumn>
									<name>HeaderID</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>referenceKey</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>refer</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>orddat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>magcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>selcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>ord_soort</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>fiattering</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordbv_afgd</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>colli</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bruto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>netto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>tot_bdr</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>projectnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>Field09</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>IsUseAdditionalFields</name>
									<type>Int32</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>EG: Create TransportOrder (Header)</stepname>
			</step>
			<step>
				<id>5405</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>101</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'ABSC: Collect EG Create Results (Header)'
					DECLARE @numProcessed int


					-- Check Order Create
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Check Order Create.')


					-- 'Transaction Log' for T-Shoot and insight
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT
					, bkstnr
					, ordernr
					, MESSAGE
					, transportOrderNr
					, [magcode_FoB]
					, [magcode] )
					SELECT %param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName
					, iPOr.bkstnr
					, iPOr.ordernr
					, CASE ISNULL(EntR.rowstatus,-1)
					WHEN 2 THEN 'Transport Order Created'
					ELSE ISNULL(EntR.errormessage, 'No result for Order found')
					END
					, EntR.NewKeyvalue
					-- FO-48 Extend CD 04.345.682
					, iPOr.[magcode_FoB]
					, iPOr.[magcode]
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					-- New ordernr
					LEFT OUTER JOIN [%abeidb%].dbo._AB_Entity_results EntR with (nolock)
					ON 1 = 1 -- '%runid%' = EntR.runid --Explicitely this run only
					and EntR.jobid =  %jobid%
					and EntR.Entity = 'PurchaseOrderHeader'
					and EntR.Action = 'create'
					and EntR.ReferenceValue =  iPOr.[bkstnr]
					WHERE iPOr.rowstatus = 1 -- being processed

					-- UPDATE Processing Params
					UPDATE iPOr  SET
					--SELECT *,
					[sysmessage] = CASE ISNULL(EntR.rowstatus,-1)
					WHEN 2 THEN 'Transport Order Created'
					ELSE ISNULL(EntR.errormessage, 'No result for Order found')
					END
					, sysmodified = CURRENT_TIMESTAMP
					, [transportOrderNr] = ISNULL(iPOr.[transportOrderNr], EntR.NewKeyvalue) -- SHOULD FAIL When iPOr.[transportOrderNr] IS NOT NULL
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (ROWLOCK, NOWAIT)
					-- New ordernr
					LEFT OUTER JOIN [%abeidb%].dbo._AB_Entity_results EntR with (nolock)
					ON 1 = 1 -- '%runid%' = EntR.runid --Explicitely this run only
					and EntR.jobid =  %jobid%
					and EntR.Entity = 'PurchaseOrderHeader'
					and EntR.Action = 'create'
					and EntR.ReferenceValue =  iPOr.[bkstnr]
					LEFT JOIN [%abeisourcedb%].dbo.AdditionalOrderHeader oht with (nolock)
					ON oht.OrderNumber = EntR.NewKeyvalue
					WHERE iPOr.rowstatus = 1 -- being processed
					AND EntR.NewKeyvalue IS NOT NULL
					AND oht.[%param_order_Header_additionalfield_name%] = iPOr.ordernr -- double check


					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Checked Creation: ' + CONVERT(varchar(10), @numProcessed)+ ' Transport Orders' )


				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>105</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>refer</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>magcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>selcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>ord_soort</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>fiattering</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordbv_afgd</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>colli</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bruto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>netto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>tot_bdr</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ord_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ship_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_kb_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_disc_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_ev_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>projectnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield1</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield2</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>ABSC: Collect EG Create Results (Header)</stepname>
			</step>
			<step>
				<id>5406</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>101</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'ABSC: Collect EG Create Results (Line)'
					DECLARE @numProcessed int

					-- Check Order Line Create

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Check Order Line Create.')

					-- 'Transaction Log' for T-Shoot and insight in retries....
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT
					, bkstnr
					, ordernr
					, orderLineID
					, MESSAGE
					, transportOrderNr
					, transportOrderLineId
					, [magcode_FoB]         -- FO-48 Extend CD 04.345.682
					, [magcode] )
					SELECT %param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName
					, iPOr.bkstnr
					, iPOr.ordernr
					, iPOr.orderLineID
					, CASE ISNULL(EntR.rowstatus,-1)
					WHEN 2 THEN 'Order Line Create reports success'
					ELSE ISNULL(EntR.errormessage, 'No result for Order Line found') END
					, iPOr.transportOrderNr
					, ol.ID
					, iPOr.[magcode_FoB]   -- FO-48 Extend CD 04.345.682
					, iPOr.[magcode]
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					-- Results for lines
					LEFT OUTER JOIN [%abeidb%].dbo._AB_Entity_results EntR with (nolock)
					ON 1 = 1 -- '%runid%' = EntR.runid --Explicitely this run only
					and EntR.jobid =  %jobid%
					and EntR.Entity = 'PurchaseOrderLine'
					and EntR.Action = 'create'
					and EntR.ReferenceValue = iPOr.[orderLineID]
					LEFT JOIN [%abeisourcedb%].dbo.AdditionalOrderLines olt WITH (NOLOCK)
					ON  LTRIM(RTRIM(STR(iPOr.[orderLineID]))) = olt.Field02 COLLATE DATABASE_DEFAULT
					LEFT JOIN [%abeisourcedb%].dbo.orsrg ol (NOLOCK)
					ON olt.OrderNumber = ol.ordernr
					AND olt.LineNumber = ol.regel
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed

					-- UPDATE Processing Params
					UPDATE iPOr  SET
					--SELECT *,
					[sysmessage] =
					CASE ISNULL(EntR.rowstatus,-1)
					WHEN 2 THEN 'Order Line Create reports success'
					ELSE
					CASE WHEN iPOr.[sysmessage]  IS NULL
					THEN ISNULL(EntR.errormessage, 'No result for Order Line found')
					ELSE ISNULL(EntR.errormessage, 'No result for Order Line found') + CHAR(13) + CHAR(10)
					+ iPOr.[sysmessage]
					END
					END
					, sysmodified = CURRENT_TIMESTAMP
					, [transportOrderLineId] = ISNULL(iPOr.[transportOrderLineId], ol.ID) -- SHOULD FAIL When iPOr.[transportOrderLineId] IS NOT NULL
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (ROWLOCK, NOWAIT)
					-- Results for lines
					LEFT OUTER JOIN [%abeidb%].dbo._AB_Entity_results EntR with (nolock)
					ON 1 = 1 -- '%runid%' = EntR.runid --Explicitely this run only
					and EntR.jobid =  %jobid%
					and EntR.Entity = 'PurchaseOrderLine'
					and EntR.Action = 'create'
					and EntR.ReferenceValue = iPOr.[orderLineID]
					LEFT JOIN [%abeisourcedb%].dbo.AdditionalOrderLines olt WITH (NOLOCK)
					ON  LTRIM(RTRIM(STR(iPOr.[orderLineID]))) = olt.[%param_order_Line_additionalfield_name%] COLLATE DATABASE_DEFAULT
					LEFT JOIN [%abeisourcedb%].dbo.orsrg ol (NOLOCK)
					ON olt.OrderNumber = ol.ordernr
					AND olt.LineNumber = ol.regel
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed


					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Checked Creation: ' + CONVERT(varchar(10), @numProcessed)+ ' Transport OrderLines' )

				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>105</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>refer</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>magcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>selcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>ord_soort</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>fiattering</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordbv_afgd</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>colli</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bruto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>netto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>tot_bdr</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ord_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ship_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_kb_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_disc_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_ev_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>projectnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield1</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield2</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>ABSC: Collect EG Create Results (Line)</stepname>
			</step>
			<step>
				<id>5407</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>101</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'ABSC: Check for Auto-Authorization'
					DECLARE @numProcessed int

					-- Check Order Authorize
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Check SDK Order Authorize.')


					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Check EG Order Authorize.')

					-- 'Transaction Log' for T-Shoot and insight in retries....
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT
					, bkstnr
					, ordernr
					, orderLineID
					, MESSAGE
					, transportOrderNr
					, transportOrderLineId
					, [magcode_FoB] -- FO-48 Extend CD 04.345.682
					, [magcode]     -- FO-48 Extend CD 04.345.682
					)
					SELECT %param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName,
					iPOr.bkstnr
					, iPOr.ordernr
					, iPOr.orderLineID
					, CASE WHEN (oh.fiattering = 'J')
					THEN 'EG Order Authorize success'
					ELSE 'EG Order NOT listed as authorized'
					END as [Message]
					, iPOr.transportOrderNr
					, iPOr.transportOrderLineId
					, iPOr.[magcode_FoB]  -- FO-48 Extend CD 04.345.682
					, iPOr.[magcode]      -- FO-48 Extend CD 04.345.682
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					-- Results for print
					INNER JOIN [%abeisourcedb%].dbo.orkrg oh (NOLOCK)
					ON oh.ordernr = iPOr.transportOrderNr
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed
					AND ISNULL(iPOr.[transportOrderAuthorized], 0) = 0

					-- UPDATE Processing Params
					UPDATE iPOr  SET
					--SELECT *,
					[sysmessage] =
					CASE WHEN (oh.fiattering = 'J')
					THEN
					CASE WHEN iPOr.[sysmessage]  IS NULL
					THEN 'Order is Authorized'
					ELSE 'Order is Authorized'+ CHAR(13) + CHAR(10)
					+ iPOr.[sysmessage]
					END
					ELSE
					CASE WHEN iPOr.[sysmessage]  IS NULL
					THEN 'Order NOT listed as -'
					ELSE 'Order NOT listed as authorized' + CHAR(13) + CHAR(10)
					+ iPOr.[sysmessage]
					END
					END

					, sysmodified = CURRENT_TIMESTAMP
					, [transportOrderAuthorized] = CASE oh.fiattering WHEN 'J' THEN 1 ELSE 0 END
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (ROWLOCK, NOWAIT)
					-- Results for print
					INNER JOIN [%abeisourcedb%].dbo.orkrg oh (NOLOCK)
					ON oh.ordernr = iPOr.transportOrderNr
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed
					AND ISNULL(iPOr.[transportOrderAuthorized], 0) = 0


					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Auto-Authorization Checked: ' + CONVERT(varchar(10), @numProcessed)+ ' Transport Order Lines' )

				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>109</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>refer</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>magcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>selcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>ord_soort</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>fiattering</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordbv_afgd</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>colli</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bruto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>netto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>tot_bdr</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ord_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ship_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_kb_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_disc_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_ev_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>projectnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield1</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield2</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>ABSC: Check for Auto-Authorization</stepname>
			</step>
			<step>
				<id>5408</id>
				<entity>SDK-PurchaseOrder-Authorize</entity>
				<action>process</action>
				<source>103</source>
				<target>101</target>
				<datasource>
					SELECT DISTINCT
					--    1 as IsFinal,
					iPOr.transportOrderNr as ordernr

					FROM [%abeisourcedb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					WHERE iPOr.rowstatus = 1        -- being processed
					--  AND iPOr.runid = '%runid%'  -- in this run explicitely
					-- double check:
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has NOT  been listed
					AND iPOr.transportOrderLineId IS NOT NULL -- Transport Order NOT Line has been listed
					AND ISNULL(iPOr.[transportOrderAuthorized], 0) = 0
					--AND iPOr.TransportOrderPrinted = 0
				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>110</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>ordernr</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>EG: 'Authorize' Created Orders</stepname>
			</step>
			<step>
				<id>5409</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>101</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'ABSC: Collect EG SDK Results (Authorize)'
					DECLARE @numProcessed int

					-- Check Order Authorize
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Check SDK Order Authorize.')

					-- 'Transaction Log' for T-Shoot and insight
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT
					, bkstnr
					, ordernr
					, MESSAGE
					, transportOrderNr
					, [magcode_FoB] -- FO-48 Extend CD 04.345.682
					, [magcode]     -- FO-48 Extend CD 04.345.682
					)
					SELECT DISTINCT
					%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName
					, iPOr.bkstnr
					, iPOr.ordernr
					, CASE ISNULL(EntR.rowstatus,-1)
					WHEN 2 THEN 'SDK Reports Transport Order Authorized'
					ELSE ISNULL(EntR.errormessage, 'No SDK result for Order Authorize found')
					END
					, iPOr.transportOrderNr
					, iPOr.[magcode_FoB]  -- FO-48 Extend CD 04.345.682
					, iPOr.[magcode]      -- FO-48 Extend CD 04.345.682
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					-- SDK Authorize Result
					LEFT OUTER JOIN [%abeidb%].dbo._AB_Entity_results EntR with (nolock)
					ON 1 = 1 -- '%runid%' = EntR.runid --Explicitely this run only
					and EntR.jobid =  %jobid%
					and EntR.Entity = 'SDK-PurchaseOrder-Authorize'
					and EntR.Action = 'process'
					and EntR.KeyValue =  iPOr.transportOrderNr
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed
					AND ISNULL(iPOr.[transportOrderAuthorized], 0) = 0

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Check EG Order Authorize.')

					-- 'Transaction Log' for T-Shoot and insight in retries....
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT
					, bkstnr
					, ordernr
					, orderLineID
					, MESSAGE
					, transportOrderNr
					, transportOrderLineId
					, [magcode_FoB] -- FO-48 Extend CD 04.345.682
					, [magcode]     -- FO-48 Extend CD 04.345.682
					)
					SELECT %param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName,
					iPOr.bkstnr
					, iPOr.ordernr
					, iPOr.orderLineID
					, CASE WHEN (oh.fiattering = 'J')
					THEN 'EG Order Authorize success'
					ELSE 'EG Order NOT listed as authorized'
					END as [Message]
					, iPOr.transportOrderNr
					, iPOr.transportOrderLineId
					, iPOr.[magcode_FoB]  -- FO-48 Extend CD 04.345.682
					, iPOr.[magcode]      -- FO-48 Extend CD 04.345.682
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					-- Results for print
					INNER JOIN [%abeisourcedb%].dbo.orkrg oh (NOLOCK)
					ON oh.ordernr = iPOr.transportOrderNr
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed
					AND ISNULL(iPOr.[transportOrderAuthorized], 0) = 0

					-- UPDATE Processing Params
					UPDATE iPOr  SET
					--SELECT *,
					[sysmessage] =
					CASE WHEN (oh.fiattering = 'J')
					THEN
					CASE WHEN iPOr.[sysmessage]  IS NULL
					THEN 'Order Authorize success'
					ELSE 'Order Authorize success'+ CHAR(13) + CHAR(10)
					+ iPOr.[sysmessage]
					END
					ELSE
					CASE WHEN iPOr.[sysmessage]  IS NULL
					THEN 'Order NOT listed as -'
					ELSE 'Order NOT listed as authorized' + CHAR(13) + CHAR(10)
					+ iPOr.[sysmessage]
					END
					END

					, sysmodified = CURRENT_TIMESTAMP
					, [transportOrderAuthorized] = CASE oh.fiattering WHEN 'J' THEN 1 ELSE 0 END
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (ROWLOCK, NOWAIT)
					-- Results for print
					INNER JOIN [%abeisourcedb%].dbo.orkrg oh (NOLOCK)
					ON oh.ordernr = iPOr.transportOrderNr
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed
					AND ISNULL(iPOr.[transportOrderAuthorized], 0) = 0


					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Authorization Checked: ' + CONVERT(varchar(10), @numProcessed)+ ' Transport Order Lines' )

				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>115</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>refer</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>magcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>selcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>ord_soort</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>fiattering</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordbv_afgd</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>colli</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bruto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>netto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>tot_bdr</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ord_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ship_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_kb_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_disc_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_ev_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>projectnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield1</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield2</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>ABSC: Collect EG SDK Results (Authorize)</stepname>
			</step>
			<step>
				<id>5410</id>
				<entity>SDK-PurchaseOrder-PrintProcess</entity>
				<action>process</action>
				<source>103</source>
				<target>101</target>
				<datasource>
					SELECT DISTINCT
					1 as IsFinal,
					iPOr.transportOrderNr as ordernr,
					0 as PrintDestination, -- printer; 1: Email
					'PMA001' as PrintLayout
					FROM [%abeisourcedb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					WHERE iPOr.rowstatus = 1        -- being processed
					--  AND iPOr.runid = '%runid%'  -- in this run explicitely
					-- double check:
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has NOT  been listed
					AND iPOr.transportOrderLineId IS NOT NULL -- Transport Order NOT Line has been listed
					AND ISNULL(iPOr.[transportOrderAuthorized], 0) = 1
					AND ISNULL(iPOr.TransportOrderPrinted, 0) = 0
				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>120</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>IsFinal</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordernr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>PrintDestination</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>PrintLayout</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>EG: 'Print' Created Orders</stepname>
			</step>
			<step>
				<id>5411</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>101</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'ABSC: Collect EG SDK Results (Print)'
					DECLARE @numProcessed int

					-- Check Order Print
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Check SDK Order Print.')

					-- 'Transaction Log' for T-Shoot and insight
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT
					, bkstnr
					, ordernr
					, MESSAGE
					, transportOrderNr
					, [magcode_FoB] -- FO-48 Extend CD 04.345.682
					, [magcode]     -- FO-48 Extend CD 04.345.682
					)
					SELECT DISTINCT
					%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName
					, iPOr.bkstnr
					, iPOr.ordernr
					, CASE ISNULL(EntR.rowstatus,-1)
					WHEN 2 THEN 'SDK Reports Transport Order Printed'
					ELSE ISNULL(EntR.errormessage, 'No SDK result for Order Print found')
					END
					, iPOr.transportOrderNr
					, iPOr.[magcode_FoB]  -- FO-48 Extend CD 04.345.682
					, iPOr.[magcode]      -- FO-48 Extend CD 04.345.682
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					-- SDK Print Result
					LEFT OUTER JOIN [%abeidb%].dbo._AB_Entity_results EntR with (nolock)
					ON 1 = 1 -- '%runid%' = EntR.runid --Explicitely this run only
					and EntR.jobid =  %jobid%
					and EntR.Entity = 'SDK-PurchaseOrder-PrintProcess'
					and EntR.Action = 'process'
					and EntR.KeyValue =  iPOr.transportOrderNr
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Check EG Order Print.')

					-- 'Transaction Log' for T-Shoot and insight in retries....
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT
					, bkstnr
					, ordernr
					, orderLineID
					, MESSAGE
					, transportOrderNr
					, transportOrderLineId )
					SELECT %param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName,
					iPOr.bkstnr
					, iPOr.ordernr
					, iPOr.orderLineID
					, CASE WHEN oh.ordbv_afgd = 1
					THEN 'EG Order Print success'
					ELSE 'EG Order NOT listed as printed'
					END as [Message]
					, iPOr.transportOrderNr
					, iPOr.transportOrderLineId

					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					-- Results for print
					INNER JOIN [%abeisourcedb%].dbo.orkrg oh (NOLOCK)
					ON oh.ordernr = iPOr.transportOrderNr
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed

					-- UPDATE Processing Params
					UPDATE iPOr  SET
					--SELECT *,
					[sysmessage] =
					CASE WHEN oh.ordbv_afgd = 1
					THEN
					CASE WHEN iPOr.[sysmessage]  IS NULL
					THEN 'Order Print success'
					ELSE 'Order Print success'+ CHAR(13) + CHAR(10)
					+ iPOr.[sysmessage]
					END
					ELSE
					CASE WHEN iPOr.[sysmessage]  IS NULL
					THEN 'Order NOT listed as printed'
					ELSE 'Order NOT listed as printed' + CHAR(13) + CHAR(10)
					+ iPOr.[sysmessage]
					END
					END

					, sysmodified = CURRENT_TIMESTAMP
					, [transportOrderPrinted] =oh.ordbv_afgd
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (ROWLOCK, NOWAIT)
					-- Results for print
					INNER JOIN [%abeisourcedb%].dbo.orkrg oh (NOLOCK)
					ON oh.ordernr = iPOr.transportOrderNr
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed


					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, syscreated, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Print Checked: ' + CONVERT(varchar(10), @numProcessed)+ ' Transport Order Lines' )

				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>125</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>refer</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>magcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>selcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>ord_soort</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>fiattering</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordbv_afgd</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>colli</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bruto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>netto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>tot_bdr</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ord_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ship_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_kb_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_disc_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_ev_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>projectnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield1</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield2</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>ABSC: Collect EG SDK Results (Print)</stepname>
			</step>
			<step>
				<id>5412</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>101</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'ABSC: EG Results List Success (rowstatus=2)'
					DECLARE @numProcessed int

					-- LIST Success

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Check Order &amp; OrderLine Registration.')

					-- 'Transaction Log' for T-Shoot and insight in retries....
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT
					, bkstnr
					, ordernr
					, orderLineID
					, MESSAGE
					, transportOrderNr
					, transportOrderLineId
					, [magcode_FoB] -- FO-48 Extend CD 04.345.682
					, [magcode]     -- FO-48 Extend CD 04.345.682
					)
					SELECT %param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName
					, iPOr.bkstnr
					, iPOr.ordernr
					, iPOr.orderLineID
					, 'Successfully processed Purchase Order, setting rowStatus = 2'
					, iPOr.transportOrderNr
					, iPOr.transportOrderLineId
					, iPOr.[magcode_FoB]  -- FO-48 Extend CD 04.345.682
					, iPOr.[magcode]      -- FO-48 Extend CD 04.345.682
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed
					AND iPOr.transportOrderLineId IS NOT NULL -- Transport Order Line has been listed
					AND iPOr.[transportOrderAuthorized] = 1
					AND iPOr.[transportOrderPrinted] = 1

					-- UPDATE Processing Params
					UPDATE iPOr  SET
					--SELECT *,
					runid = '%runid%'
					, rowstatus = 2
					--   , [retry_counter]= CASE WHEN ISNULL(EntR.rowstatus,-1) &lt;&gt; 2 THEN iPOr.[retry_counter] + 1 ELSE iPOr.[retry_counter] END
					, sysmodified = CURRENT_TIMESTAMP
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (ROWLOCK, NOWAIT)
					WHERE iPOr.rowstatus = 1 -- being processed
					AND iPOr.transportOrderNr IS NOT NULL -- Transport Order has been listed
					AND iPOr.transportOrderLineId IS NOT NULL -- Transport Order Line has been listed
					AND iPOr.[transportOrderAuthorized] = 1
					AND iPOr.[transportOrderPrinted] = 1

					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Sucessfully registered: ' + CONVERT(varchar(10), @numProcessed)+ ' Transport OrderLines (including Orders)' )



				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>150</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>refer</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>magcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>selcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>ord_soort</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>fiattering</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordbv_afgd</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>colli</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bruto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>netto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>tot_bdr</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ord_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ship_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_kb_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_disc_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_ev_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>projectnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield1</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield2</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>ABSC: EG Results List Success (rowstatus=2)</stepname>
			</step>
			<step>
				<id>5413</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>0</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'ABSC: Count Retry'
					DECLARE @numProcessed int

					-- Not Yet succeeded
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Stage retry for unsuccesful (yet).')

					UPDATE iPOr  SET
					--SELECT *,
					[retry_counter] = iPOr.[retry_counter] + 1
					, [sysmessage] =
					CASE WHEN iPOr.[sysmessage]  IS NULL
					THEN 'Transport Order or Order Line NOT Listed'
					ELSE 'Transport Order or Order Line NOT Listed' + CHAR(13) + CHAR(10) + iPOr.[sysmessage]
					END
					, sysmodified = CURRENT_TIMESTAMP
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (ROWLOCK, NOWAIT)
					WHERE iPOr.rowstatus = 1 -- being processed
					AND (iPOr.transportOrderNr IS NULL -- Transport Order has NOT  been listed
					OR iPOr.transportOrderLineId IS NULL -- Transport Order NOT Line has been listed
					OR iPOr.[transportOrderAuthorized] = 0
					OR iPOr.[transportOrderPrinted] = 0
					)

					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName
					, 'Updated: ' + CONVERT(varchar(10), @numProcessed)+ ' Transport OrderLines (including Orders) for retry' )



					-- 'Transaction Log' for T-Shoot and insight in retries....
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT
					, bkstnr
					, ordernr
					, orderLineID
					, MESSAGE
					, [magcode_FoB] -- FO-48 Extend CD 04.345.682
					, [magcode]     -- FO-48 Extend CD 04.345.682
					)
					SELECT %param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName
					, iPOr.bkstnr
					, iPOr.ordernr
					, iPOr.orderLineID
					, 'Not yet succeeded. Increment retry to ' + STR(iPOr.retry_counter)
					, iPOr.[magcode_FoB]  -- FO-48 Extend CD 04.345.682
					, iPOr.[magcode]      -- FO-48 Extend CD 04.345.682
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)

					WHERE iPOr.rowstatus = 1 -- being processed
					AND (iPOr.transportOrderNr IS NULL -- Transport Order has NOT  been listed
					OR iPOr.transportOrderLineId IS NULL -- Transport Order NOT Line has been listed
					OR iPOr.[transportOrderAuthorized] = 0
					OR iPOr.[transportOrderPrinted] = 0
					)

				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>190</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>refer</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>magcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>selcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>ord_soort</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>fiattering</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordbv_afgd</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>colli</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bruto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>netto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>tot_bdr</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ord_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ship_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_kb_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_disc_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_ev_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>projectnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield1</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield2</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>ABSC: Count Retry (retry+1)</stepname>
			</step>
			<step>
				<id>5414</id>
				<entity>-none-</entity>
				<action>textline</action>
				<source>0</source>
				<target>0</target>
				<datasource></datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>1</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>200</seqno>
				<settings></settings>
				<settingsxml />
				<stepname>==                FAIL Handling                  ==</stepname>
			</step>
			<step>
				<id>5415</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>103</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'ABSC: Set Fail on too many tries'
					DECLARE @numProcessed int

					-- Check Order Creation
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Failing after  %param_max_retry_counter% retries.')

					-- 'Transaction Log' for T-Shoot and insight in retries....
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT
					, bkstnr
					, ordernr
					, orderLineID
					, MESSAGE
					, [magcode_FoB] -- FO-48 Extend CD 04.345.682
					, [magcode]     -- FO-48 Extend CD 04.345.682
					)
					SELECT %param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName
					, iPOr.bkstnr
					, iPOr.ordernr
					, iPOr.orderLineID
					, 'FAILED to process Purchase Order. Giving up. Setting rowstatus =-1. Too many retries: ' + STR(iPOr.retry_counter)
					, iPOr.[magcode_FoB]  -- FO-48 Extend CD 04.345.682
					, iPOr.[magcode]      -- FO-48 Extend CD 04.345.682
					FROM [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					WHERE iPOr.rowstatus = 1
					AND iPOr.retry_counter &gt; %param_max_retry_counter%

					UPDATE iPOr
					SET rowstatus = -1
					, [sysmessage] = CASE WHEN iPOr.[sysmessage]  IS NULL
					THEN 'Too many Retries'
					ELSE 'Too many Retries' + CHAR(13) + CHAR(10)
					+ iPOr.[sysmessage]
					END
					, runid = '%runid%' -- For later messaging
					--   SELECT *
					FROM  [%abeisourcedb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (ROWLOCK, NOWAIT)
					WHERE iPOr.rowstatus = 1
					AND iPOr.retry_counter &gt; %param_max_retry_counter%

					SELECT @numProcessed=@@ROWCOUNT

					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Failed: ' + CONVERT(varchar(10), @numProcessed)+ ' Transport Orders/Lines' )

				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>200</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>refer</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>magcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>selcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>ord_soort</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>fiattering</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordbv_afgd</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>colli</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bruto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>netto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>tot_bdr</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ord_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ship_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_kb_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_disc_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_ev_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>projectnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield1</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield2</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>ABSC: Set Fail on too many tries (rowstatus = -1)</stepname>
			</step>
			<step>
				<id>5416</id>
				<entity>-none-</entity>
				<action>create</action>
				<source>103</source>
				<target>6</target>
				<datasource>
					SELECT
					'ABEI Encountered difficulties creating Transport Orders in Job %jobid%' as querySubject
					, [Id]
					,[ExactDbNum]
					,[syscreated]
					,[sysmodified]
					,[runid]
					,[rowstatus]
					,[sysmessage]
					,[retry_counter]
					,[bkstnr]
					,[artcode]
					,[aantal]
					,FORMAT( [datumOntvangst], 'd', 'nl-NL') as [datumOntvangst]
					,[orderLineID]
					,[ordernr]
					,[levwijze]
					,FORMAT( [planned_deliveryDate], 'd', 'nl-NL') as [planned_deliveryDate]
					,[purchaseCreditor]
					,[additionalDelDays]
					,[transporterCreditor]
					,[transportOrderNr]
					,[transportOrderLineId]
					, iPOr.[magcode_FoB]  -- FO-48 Extend CD 04.345.682
					, iPOr.[magcode]      -- FO-48 Extend CD 04.345.682
					FROM  [%abeisourcedb%].[dbo].[%Tablename_Preceder%_Initial_PurchaseOrder_Receipts]  as iPOr WITH (NOLOCK)
					WHERE iPOr.rowstatus = -1
					AND runid = '%runid%'
				</datasource>
				<contentbody>
					&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
					&lt;HTML&gt;
					&lt;HEAD&gt;&lt;META content="text/html; charset=UTF-8" http-equiv=Content-Type /&gt;&lt;META name=GENERATOR content="MSHTML 11.00.9600.18036" /&gt;&lt;/HEAD&gt;&lt;body &gt;&lt;p&gt;&lt;font face="Calibri"&gt;Geachte lezer,&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;font face="Calibri"&gt;&lt;p&gt;Onderstaande meldingen zijn voorgekomen bij het aanmaken van de Transport Orders in&lt;br&gt;Transport Orders (dit zijn purchase orders met selcode &lt;font color="black"&gt;TR&lt;/font&gt;) worden aangemaakt wanneer&amp;nbsp; &lt;strong&gt;Free on Board &lt;/strong&gt;Purchase Orders ontvangen worden in &lt;em&gt;'Warehouse 99'&lt;/em&gt;&lt;/p&gt;&lt;p&gt;U ontvangt deze mail zodat u na kunt kijken en eventueel correcties door kunt voeren.&lt;br&gt;De reeds ontvangen goederen voor de Purchase Orders in onderstaand overzicht&amp;nbsp;zullen niet opnieuw geautomatiseerd een Transport Order genereren.&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;table style="border-width: 1px; border-collapse: collapse;" border="1" cellspacing="0" cellpadding="1"&gt;&lt;tbody&gt;&lt;tr bgcolor="skyblue"&gt;&lt;td&gt;PO ordernr&lt;/td&gt;&lt;td&gt;PO Crediteur&lt;/td&gt;&lt;td&gt;Ontvangst&lt;br&gt;(bkstnr)&lt;/td&gt;&lt;td&gt;Art. Code&lt;/td&gt;&lt;td&gt;aantal&lt;/td&gt;&lt;td&gt;Levering&lt;br&gt;Wijze&lt;/td&gt;&lt;td&gt;datum &lt;br&gt;Ontvangst&lt;/td&gt;&lt;td&gt;geplande&lt;br&gt;Leverdatum&lt;br&gt;&lt;/td&gt;&lt;td&gt;Transport &lt;br&gt;Dagen&lt;/td&gt;&lt;td&gt;Transport&lt;br&gt;Crediteur&lt;/td&gt;&lt;td&gt;Transport&lt;br&gt;OrderNr&lt;br&gt;(als aanwezig)&lt;/td&gt;&lt;td&gt;Transport&lt;br&gt;OrderLine Id&lt;br&gt;(als aanwezig)&lt;/td&gt;&lt;td&gt;# keer&lt;br&gt;geprobeerd&lt;/td&gt;&lt;td&gt;Meding&lt;/td&gt;&lt;/tr&gt;&lt;tr class="abei_dynamic_row"&gt;&lt;td&gt;%ordernr%&lt;/td&gt;&lt;td&gt;%purchaseCreditor%&lt;/td&gt;&lt;td&gt;%bkstnr%&lt;/td&gt;&lt;td&gt;%artcode%&lt;/td&gt;&lt;td&gt;%aantal%&lt;/td&gt;&lt;td&gt;%levwijze%&lt;/td&gt;&lt;td&gt;%datumOntvangst%&lt;/td&gt;&lt;td&gt;%planned_deliveryDate%&lt;/td&gt;&lt;td&gt;%additionalDelDays%&lt;/td&gt;&lt;td&gt;%transporterCreditor%&lt;/td&gt;&lt;td&gt;%transportOrderNr%&lt;/td&gt;&lt;td&gt;%transportOrderLineId%&lt;/td&gt;&lt;td&gt;%retry_counter%&lt;/td&gt;&lt;td&gt;%sysmessage%&lt;/td&gt;&lt;/tr&gt;&lt;tr bgcolor="silver" color="black"&gt;&lt;td colspan="25"&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/font&gt;&lt;p&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;Deze mail is automatisch gegenereerd door ABEI om %abeinow% &lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;&lt;font face="Calibri"&gt;Exact&amp;nbsp;DB: %ExactDbNum%.&lt;br&gt;Server: %abeiserver%&lt;br&gt;Runid: %runid%&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/p&gt;&lt;pre&gt;&lt;br&gt;&lt;/pre&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;/body&gt;&lt;/HTML&gt;
				</contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>210</seqno>
				<settings>retryunique=0;uniquekey=;emailfrom=info@quooker.nl;emailname=info@quooker.nl;emailreplyto=info@quooker.nl;emailuser=relay@quooker.com;emailpwd=YXc4PVd5Oj7Lf0Lk8N+QYg%equalchar%%equalchar%;emailserver=smtp.office365.com;emailport=587;emailssl=True;emailto=%param_email_for_send_message%;emailcc=;emailbcc=;emailsub=%querySubject%;emailbodyusesource=0;emailsendifnoresults=0;emailcontentcolumns=ordernr,purchaseCreditor,bkstnr,artcode,aantal,levwijze,datumOntvangst,planned_deliveryDate,additionalDelDays,transporterCreditor,transportOrderNr,transportOrderLineId;mex_connectionid=0;emailsplitcolumn=querySubject;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>querySubject</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>Id</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ExactDbNum</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>syscreated</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>sysmodified</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>runid</name>
									<type>Guid</type>
								</datacolumn>
								<datacolumn>
									<name>rowstatus</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>sysmessage</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>retry_counter</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bkstnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>artcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>aantal</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>datumOntvangst</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>orderLineID</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordernr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>planned_deliveryDate</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>purchaseCreditor</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>additionalDelDays</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>transporterCreditor</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>HeaderId</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>transportOrderNr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>transportOrderLineId</name>
									<type>Int32</type>
								</datacolumn>
							</datacolumns>
						</general>
						<email>
							<emailattachment_allowduplicate>false</emailattachment_allowduplicate>
							<emailimpersonation_account />
							<emailbodytype>html</emailbodytype>
							<emailsaveasdraft>false</emailsaveasdraft>
							<attachments />
						</email>
					</settings>
				</settingsxml>
				<stepname>Emai Fails this run</stepname>
			</step>
			<step>
				<id>5417</id>
				<entity>-none-</entity>
				<action>process</action>
				<source>103</source>
				<target>80</target>
				<datasource>
					SELECT CASE WHEN LOWER('%param_retry_directly%') = 'true'
					THEN 95 -- Quit if nothing to do
					ELSE 300 -- Log End
					END as gotoStepNo
				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>215</seqno>
				<settings>uniquekey=;retryunique=0;sysaction=12;sysfilefolder=;sysparams=;syswait=True;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<jobparams />
							<datacolumns>
								<datacolumn>
									<name>gotoStepNo</name>
									<type>Int32</type>
								</datacolumn>
							</datacolumns>
						</general>
						<systemtarget>
							<systemtarget_param2 />
							<systemtarget_param3 />
							<systemtarget_param4 />
							<systemtarget_param5 />
							<systemtarget_param6 />
							<systemtarget_skiptoseqno>%gotoStepNo%</systemtarget_skiptoseqno>
							<systemtarget_sleep>0</systemtarget_sleep>
							<systemtarget_user />
							<systemtarget_pwd>TFEEY7QNB86Yzc1ll50jtg%equalchar%%equalchar%</systemtarget_pwd>
						</systemtarget>
					</settings>
				</settingsxml>
				<stepname>Directly Retry if param set  ------------ 95^</stepname>
			</step>
			<step>
				<id>5418</id>
				<entity>-none-</entity>
				<action>exec SQL</action>
				<source>103</source>
				<target>103</target>
				<datasource>
					DECLARE @stepName [varchar](255) = 'ABSC: Log End'
					DECLARE @numProcessed int

					-- Check Order Creation
					INSERT INTO [%abeitargetdb%].[dbo].[%Tablename_Preceder%_Log] (ExactDbNum, jobid, jobstepid, runid, SYSCREATED, SUBJECT, MESSAGE )
					VALUES (%param_eg_division%, %jobid%, %jobstepid%, '%runid%', CURRENT_TIMESTAMP, @stepName, 'Job Finished to completion.')
				</datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>0</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>300</seqno>
				<settings>uniquekey=;retryunique=0;</settings>
				<settingsxml>
					<settings>
						<general>
							<gen_datasource_method>0</gen_datasource_method>
							<target_override />
							<referencekey />
							<datacolumns>
								<datacolumn>
									<name>refer</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>afldat</name>
									<type>DateTime</type>
								</datacolumn>
								<datacolumn>
									<name>magcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>selcode</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>ord_soort</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>fiattering</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>ordbv_afgd</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>levwijze</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>colli</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bruto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>netto_gew</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>tot_bdr</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>crdnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ord_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_ship_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_kb_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_disc_val</name>
									<type>Double</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_ev_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>bdr_vat_val</name>
									<type>Int32</type>
								</datacolumn>
								<datacolumn>
									<name>projectnr</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield1</name>
									<type>String</type>
								</datacolumn>
								<datacolumn>
									<name>freefield2</name>
									<type>String</type>
								</datacolumn>
							</datacolumns>
						</general>
					</settings>
				</settingsxml>
				<stepname>ABSC: Log End</stepname>
			</step>
			<step>
				<id>5419</id>
				<entity>-none-</entity>
				<action>textline</action>
				<source>0</source>
				<target>0</target>
				<datasource></datasource>
				<contentbody></contentbody>
				<mapping></mapping>
				<disable>1</disable>
				<remarks></remarks>
				<replace></replace>
				<seqno>10100</seqno>
				<settings></settings>
				<settingsxml />
				<stepname>==                   THE END                     ==</stepname>
			</step>
		</steps>
	</job>
</jobs>